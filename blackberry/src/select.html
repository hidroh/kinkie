<!DOCTYPE html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title></title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/font-awesome/css/font-awesome.css">
<link rel="stylesheet" href="css/main.css">

<script src="js/vendor/jquery-1.9.1.js"></script>
<script src="js/vendor/jquery.cookie.js"></script>
<script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
</head>
<body>
<div class="join-screen page">



<div id="fb-root"></div>

<script>
    // Copypasta from http://stackoverflow.com/questions/1403888/get-url-parameter-with-jquery
    function getURLParameter(name) {
       return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
    }

    if(!getURLParameter('access_token')) {
      var url = 'https://www.facebook.com/dialog/oauth?client_id=461663813917591&redirect_uri=http://kinkie.im/success';
      childWindow = window.open(url, '_self');
    // } else {
    } else {
      //user is already logged in and connected
      var fbMeUrl = 'https://graph.facebook.com/me?access_token=' + getURLParameter('access_token');
      $.get(fbMeUrl, function(response) {
        var user = {
            "type": "user",
            "id": response.id,
            "username": response.username,
            "name": response.first_name + ' ' + response.last_name,
            "gender": response.gender,
            "image": "https://graph.facebook.com/" + response.id + "/picture",
        }

        // conn.send(JSON.stringify(user));
        localStorage.setItem('user', JSON.stringify(user));
        $.cookie('user', JSON.stringify(user));
        window.location.href = '/join.html';
      });
    }
 

// window.fbAsyncInit = function() {
//   FB.init({ appId: '461663813917591', 
//         status: true, 
//         cookie: true,
//         xfbml: true,
//         oauth: true});

//   function updateButton(response) {
        
//     if (response.authResponse) {
//       //user is already logged in and connected
//       FB.api('/me', function(response) {
//         var user = {
//             "type": "user",
//             "id": response.id,
//             "username": response.username,
//             "name": response.first_name + ' ' + response.last_name,
//             "gender": response.gender,
//             "image": "https://graph.facebook.com/" + response.id + "/picture",
//         }

//         // conn.send(JSON.stringify(user));
//         $.cookie('user', JSON.stringify(user));
//         window.location.href = '/join.html';
//       });
//     } else {
//         //user is not connected to your app or logged out
      
//         $('#fb').click(function() {
//             FB.login(function(response) {
//                 if (response.authResponse) {
//                     FB.api('/me', function(response) {
//                         var user = {
//                             "type": "user",
//                             "id": response.id,
//                             "username": response.username,
//                             "name": response.first_name + ' ' + response.last_name,
//                             "gender": response.gender,
//                             "image": "https://graph.facebook.com/" + response.id + "/picture",
//                         }
//                         // conn.send(JSON.stringify(user));
//                         $.cookie('user', JSON.stringify(user));
//                         window.location.href = '/join';
//                     });    
//                 } else {
//                     //user cancelled login or did not grant authorization
//                 }
//             }, {scope:'email'});   
//             return false; 
//         });
      
//     }
//   }

//   // run once with current status and whenever the status changes
//   FB.getLoginStatus(updateButton); 
// };
    
// (function() {
//   var e = document.createElement('script'); e.async = true;
//   e.src = document.location.protocol 
//     + '//connect.facebook.net/en_US/all.js';
//   document.getElementById('fb-root').appendChild(e);
// }());

</script>

    <div style="text-align:center;position:relative;margin-top:-200px;height:400px;top:50%;width:300px;left:50%;margin-left:-150px;">
        
        <img src="/img/logo.png" alt="" style="width:250px;">
        <p style="color:#ffffff;">Go on.. choose one</p>
        <div style="margin-top:30px;">
            <div style="width:100%;float:left;text-align:center;">
                <div id="fb" style="background:#2c3e50;display:inline-block;padding:35px 30px;width:130px;border-radius:100px;">
                    <a href="javascript:;"><i style="font-size:60px;color:#3498db;" class="icon-facebook"></i></a>
                </div>
            </div>
        </div>
        <p style="color:#ffffff;padding-top:30px;clear:both;">yes. just facebook.</p>
    </div>    

</div>
</body>
</html>