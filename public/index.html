<!DOCTYPE html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title></title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" href="./css/bootstrap.css">
<link rel="stylesheet" href="./css/font-awesome/css/font-awesome.css">
<link rel="stylesheet" href="./css/main.css">

<script src="./js/vendor/jquery-1.9.1.js"></script>
<script src="./js/vendor/jquery.cookie.js"></script>
<script src="./js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>

<script src="http://maps.google.com/maps/api/js?sensor=true&libraries=geometry"></script>

<script type="text/javascript">
	
	var updateButton;
	
	$(document).ready(function() {
		
		function displayPage(page) {
			
			$('div.page').hide();
			$('div.page.' + page + '-screen').show();
			
		}
		
		function handleHomePage() {
			
			$('button#join').click(function() {
				displayPage('join');
			});
			
			$('button').text('Could not detect your location! :(');
			$('button').attr('disabled', 'disabled');
			
			if(navigator.geolocation != null) {
				navigator.geolocation.getCurrentPosition(function(position) {
					$('button').text('Join the fun');
					$('button').attr('disabled', false);
					
					$('button#join').trigger('click');
				}, function() {
					// Unable to get current position
				});
			} else {
				// No support for geolocation
			}
			
		}
		
		function handleProfilePage() {
		
			var user = JSON.parse($.cookie('user'));
			$('#image').css('backgroundImage', "url('" + user.image + "')").find('i').css('opacity', '0');
			$('#name').text(user.name);

			$('.goto').click(function() {
				window.location.href = '/chat';
			});
		
		}
		
		updateButton = function updateButton(response) {
			console.log('FB UPDATE BUTTON');
			console.log(response);
			if (response.authResponse) {
				
				//user is already logged in and connected
				FB.api('/me', function(response) {
					var user = {
						"type": "user",
						"id": response.id,
						"username": response.username,
						"name": response.first_name + ' ' + response.last_name,
						"gender": response.gender,
						"image": "https://graph.facebook.com/" + response.id + "/picture",
					}
					
					$.cookie('user', JSON.stringify(user));
					displayPage('profile');
					handleProfilePage();
				});
				
			} else {
			
				// user is not connected to your app or logged out
				$('#fb').click(function() {
					FB.login(function(response) {
						if (response.authResponse) {
							FB.api('/me', function(response) {
								var user = {
									"type": "user",
									"id": response.id,
									"username": response.username,
									"name": response.first_name + ' ' + response.last_name,
									"gender": response.gender,
									"image": "https://graph.facebook.com/" + response.id + "/picture",
								}
								
								$.cookie('user', JSON.stringify(user));
								displayPage('profile');
								handleProfilePage();
							});    
						} else {
							//user cancelled login or did not grant authorization
						}
					}, {scope:'email'});   
					return false; 
				});
		  
			}
		}
		
		displayPage('home');
		handleHomePage();
		
	});
	
</script>
</head>
<body>
	
	<!------------------------------- Home screen ------------------------------->
	
	<div class="home-screen page">
		
		<div style="text-align:center;position:relative;margin-top:-100px;top:50%;">
			<img src="./img/logo.png" alt="" style="width:250px;">
			<p style="color:#ffffff;">Talk to lovely people nearby.</p>
			<button id="join" class="btn" style="background:#c0392b;">Join the fun!</button>
		</div>
		
	</div>
	
	<!------------------------------- Join screen ------------------------------->
	
	<div class="join-screen page" style="display: none;">

		<div id="fb-root"></div>

		<script>

			window.fbAsyncInit = function() {
				
				FB.init({
					appId: '461663813917591', 
					status: true, 
					cookie: true,
					xfbml: true,
					oauth: true
				});
				
				// run once with current status and whenever the status changes
				FB.getLoginStatus(updateButton); 
				
			};
				
			(function() {
			  var e = document.createElement('script'); e.async = true;
			  e.src = document.location.protocol 
				+ '//connect.facebook.net/en_US/all.js';
			  document.getElementById('fb-root').appendChild(e);
			}());

		</script>

		<div style="text-align:center;position:relative;margin-top:-200px;height:400px;top:50%;width:300px;left:50%;margin-left:-150px;">
			
			<img src="/img/logo.png" alt="" style="width:250px;">
			<p style="color:#ffffff;">Go on.. choose one</p>
			<div style="margin-top:30px;">
				<div style="width:100%;float:left;text-align:center;">
					<div id="fb" style="background:#2c3e50;display:inline-block;padding:35px 30px;width:130px;border-radius:100px;">
						<a href="javascript:;"><i style="font-size:60px;color:#3498db;" class="icon-facebook"></i></a>
					</div>
				</div>
			</div>
			<p style="color:#ffffff;padding-top:30px;clear:both;">yes. just facebook.</p>
		</div>

	</div>

	<!------------------------------- Profile screen ------------------------------->
	
	<div class="profile-screen page" style="display: none;">
		
		<div style="text-align:center;position:relative;margin-top:-200px;height:400px;top:50%;width:300px;left:50%;margin-left:-150px;">
			<h1 style="color:#ffffff;">Welcome</h1>
			<div style="margin-top:50px;">
				<div style="text-align:center;">
					<div style="background:#2c3e50;display:inline-block;padding:35px 30px;width:130px;border-radius:100px;background-size:cover;" id="image">
						<i style="font-size:60px;color:#3498db;" class="icon-facebook"></i>
					</div>
				</div>
			</div>
			<h3 style="color:#ffffff;" id="name">Doctor Manhattan</h3>
			<p style="color:#ffffff;">By clicking the button below, you agree to the non-existent privacy policy we have.</p>
			<p><button class="goto btn" style="background:#f1c40f;color:#2c3e50;">Get Kinky!</button></p>
		</div>    
		
	</div>
	
</body>
</html>